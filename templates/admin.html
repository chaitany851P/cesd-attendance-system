<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>Admin Panel | CESD</title>
    <style>
        .search-container { margin-bottom: 20px; position: relative; }
        .search-input { 
            width: 100%; padding: 15px 45px; border-radius: 15px; 
            background: var(--glass); border: 1px solid var(--glass-border); color: white;
        }
        .search-icon { position: absolute; left: 15px; top: 15px; color: var(--primary); }
        .admin-table td { font-size: 0.85rem; }
        .edit-input { 
            background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); 
            color: white; padding: 5px; border-radius: 5px; width: 60px;
        }
        .dept-input { width: 80px; }
    </style>
</head>
<body>
    <div class="mesh-bg"></div>
    <nav class="navbar">
        <h1>ADMIN CONTROL</h1>
        <a href="/dashboard" class="btn-secondary" style="padding: 10px 20px;">BACK TO DASHBOARD</a>
    </nav>

    <div class="container">
        <div class="card">
            <h2 style="margin-top: 0; color: var(--primary);">Master Student Management</h2>
            <p style="color: var(--text-dim); margin-bottom: 25px;">Search for a student and update their Group or Department assignments live.</p>

            <div class="search-container">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" id="studentSearch" class="search-input" placeholder="Search by ID or Name...">
            </div>

            <div class="table-wrapper" style="max-height: 600px;">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>NAME</th>
                            <th>GROUP</th>
                            <th>DEPT</th>
                            <th>ACTION</th>
                        </tr>
                    </thead>
                    <tbody id="studentTable">
                        {% for s in students %}
                        <tr>
                            <form action="/update_student" method="POST">
                                <input type="hidden" name="student_id" value="{{ s.ID }}">
                                <td style="font-weight: 700; color: var(--secondary);">{{ s.ID }}</td>
                                <td>{{ s.Name }}</td>
                                <td>
                                    <input type="number" name="new_group" class="edit-input" value="{{ s.Assigned_Group }}" required>
                                </td>
                                <td>
                                    <input type="text" name="new_dept" class="edit-input dept-input" value="{{ s.Department }}" required>
                                </td>
                                <td>
                                    <button type="submit" class="btn-primary" style="padding: 8px 12px; font-size: 0.7rem;">
                                        SAVE
                                    </button>
                                </td>
                            </form>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Real-time Search Filter
        document.getElementById('studentSearch').addEventListener('keyup', function() {
            let filter = this.value.toUpperCase();
            let rows = document.getElementById('studentTable').getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                let idCol = rows[i].getElementsByTagName('td')[0];
                let nameCol = rows[i].getElementsByTagName('td')[1];
                if (idCol || nameCol) {
                    let textValue = (idCol.textContent || idCol.innerText) + " " + (nameCol.textContent || nameCol.innerText);
                    rows[i].style.display = textValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                }
            }
        });
    </script>
</body>
</html>
